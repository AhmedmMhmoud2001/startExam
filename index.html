<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* ========== Design System Variables ========== */
        :root {
            --primary: #0ea5e9;
            --primary-gradient: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            --success: #10b981;
            --success-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --danger: #ef4444;
            --danger-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --warning: #f59e0b;
            --dark: #1e293b;
            --light: #f8fafc;
            --border: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0c4a6e 0%, #082f49 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            color: var(--dark);
            background-attachment: fixed;
        }

        .container {
            background: white;
            border-radius: 24px;
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 1100px;
            min-height: 650px;
            overflow: hidden;
            position: relative;
            animation: fadeIn 0.6s ease-out;
        }

        /* ========== Welcome Screen ========== */
        .welcome-screen {
            padding: 3rem 2rem;
            text-align: center;
            background: linear-gradient(135deg, #0ea5e9 0%, #0c4a6e 100%);
            color: white;
            min-height: 650px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .welcome-screen::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .welcome-header {
            margin-bottom: 3rem;
            position: relative;
            z-index: 1;
        }

        .welcome-title {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
            animation: slideInDown 0.8s ease-out;
        }

        .welcome-subtitle {
            font-size: 1.4rem;
            opacity: 0.9;
            margin-bottom: 2rem;
            animation: slideInUp 0.8s ease-out;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 3rem 0;
            position: relative;
            z-index: 1;
        }

        .feature-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.2);
            transition: var(--transition);
            animation: scaleIn 0.6s ease-out;
            animation-fill-mode: both;
        }

        .feature-card:nth-child(1) { animation-delay: 0.1s; }
        .feature-card:nth-child(2) { animation-delay: 0.2s; }
        .feature-card:nth-child(3) { animation-delay: 0.3s; }
        .feature-card:nth-child(4) { animation-delay: 0.4s; }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .feature-card:hover {
            transform: translateY(-8px) scale(1.03);
            background: rgba(255,255,255,0.15);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
            transition: transform 0.3s ease;
        }

        .feature-card:hover .feature-icon {
            transform: scale(1.2);
        }

        .feature-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .exam-stats {
            background: rgba(255,255,255,0.05);
            padding: 1.5rem;
            border-radius: 16px;
            margin: 2rem 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            position: relative;
            z-index: 1;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            border-radius: 12px;
            background: rgba(255,255,255,0.05);
            transition: var(--transition);
        }

        .stat-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-3px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: #fbbf24;
            display: block;
            animation: countUp 1.5s ease-out;
        }

        @keyframes countUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 500;
        }

        .btn-primary {
            background: var(--success-gradient);
            color: white;
            padding: 1.2rem 3.5rem;
            border: none;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }

        .btn-primary:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 35px rgba(16, 185, 129, 0.5);
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        /* ========== Exam Screen ========== */
        .exam-screen {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .exam-header {
            background: var(--primary-gradient);
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            box-shadow: var(--shadow);
        }

        .exam-info {
            display: flex;
            gap: 1.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .progress-bar {
            flex: 1;
            min-width: 200px;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: white;
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .question-progress {
            font-size: 1.2rem;
            font-weight: 600;
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 50px;
        }

        .timer-box {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
        }

        .timer-box.warning {
            background: var(--warning);
            animation: pulse 1s infinite;
        }

        .timer-box.danger {
            background: var(--danger);
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .question-container {
            padding: 2rem;
            min-height: 450px;
            background: var(--light);
        }

        .question-card {
            background: white;
            border: 2px solid var(--border);
            border-radius: 20px;
            padding: 2.5rem;
            margin-bottom: 1.5rem;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            animation: slideInUp 0.4s ease-out;
        }

        .question-card:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1), var(--shadow);
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .question-number {
            background: var(--primary-gradient);
            color: white;
            min-width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.2rem;
            flex-shrink: 0;
            animation: scaleIn 0.5s ease-out;
            animation-delay: 0.2s;
            animation-fill-mode: both;
        }

        .question-text {
            font-size: 1.4rem;
            font-weight: 600;
            line-height: 1.6;
            color: var(--dark);
            flex: 1;
        }

        .question-meta {
            margin-top: 0.5rem;
            display: flex;
            gap: 1rem;
            font-size: 0.9rem;
            color: #64748b;
        }

        .meta-tag {
            background: #f1f5f9;
            padding: 0.25rem 0.75rem;
            border-radius: 8px;
            font-weight: 500;
        }

        .options-container {
            display: grid;
            gap: 1rem;
        }

        .option-wrapper {
            position: relative;
        }

        .option-input {
            position: absolute;
            opacity: 0;
        }

        .option-label {
            display: flex;
            align-items: center;
            padding: 1.25rem 1.5rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            background: white;
            font-size: 1.1rem;
            font-weight: 500;
            box-shadow: var(--shadow-sm);
        }

        .option-label:hover {
            border-color: var(--primary);
            background: #f0f9ff;
            transform: translateX(-5px);
        }

        .option-input:checked + .option-label {
            border-color: var(--primary);
            background: #eff6ff;
            box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1), var(--shadow-sm);
        }

        .option-input:checked + .option-label::after {
            content: 'âœ“';
            margin-right: auto;
            font-weight: bold;
            color: var(--primary);
            font-size: 1.4rem;
        }

        .option-letter {
            font-weight: 700;
            color: var(--primary);
            margin-left: 1rem;
            min-width: 24px;
            font-size: 1.1rem;
        }

        /* ========== Navigation ========== */
        .nav-container {
            padding: 1.5rem 2rem;
            background: var(--light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            border-top: 1px solid var(--border);
        }

        .question-nav-grid {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            max-width: 600px;
        }

        .nav-btn {
            width: 45px;
            height: 45px;
            border: 2px solid var(--border);
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            transition: var(--transition);
            font-size: 0.9rem;
            box-shadow: var(--shadow-sm);
        }

        .nav-btn:hover {
            border-color: var(--primary);
            background: #f0f9ff;
            transform: translateY(-3px);
        }

        .nav-btn.answered {
            background: var(--success-gradient);
            color: white;
            border-color: var(--success);
        }

        .nav-btn.current {
            background: var(--primary-gradient);
            color: white;
            border-color: var(--primary);
            transform: scale(1.15);
            box-shadow: 0 4px 15px rgba(14, 165, 233, 0.4);
        }

        .nav-btn.review {
            background: var(--warning);
            color: white;
            border-color: var(--warning);
            animation: pulse 2s infinite;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
        }

        .btn-secondary {
            background: white;
            border: 2px solid var(--border);
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            background: #f0f9ff;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success-gradient);
            color: white;
            box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 10px rgba(14, 165, 233, 0.3);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(14, 165, 233, 0.4);
        }

        /* ========== Results Screen ========== */
        .results-screen {
            display: none;
            padding: 2rem;
            animation: fadeIn 0.6s ease-in;
        }

        .results-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .score-circle {
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: var(--success-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            color: white;
            font-size: 3.5rem;
            font-weight: 800;
            box-shadow: var(--shadow-xl);
            position: relative;
            animation: scaleIn 0.8s ease-out;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(transparent 0deg, rgba(255,255,255,0.3) 360deg);
            animation: rotate 3s linear infinite;
        }

        .score-circle span {
            position: relative;
            z-index: 1;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .result-card {
            background: white;
            padding: 1.5rem;
            border-radius: 16px;
            border: 1px solid var(--border);
            text-align: center;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            animation: slideInUp 0.6s ease-out;
            animation-fill-mode: both;
        }

        .result-card:nth-child(1) { animation-delay: 0.1s; }
        .result-card:nth-child(2) { animation-delay: 0.2s; }
        .result-card:nth-child(3) { animation-delay: 0.3s; }
        .result-card:nth-child(4) { animation-delay: 0.4s; }
        .result-card:nth-child(5) { animation-delay: 0.5s; }
        .result-card:nth-child(6) { animation-delay: 0.6s; }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .result-card h3 {
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .result-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
        }

        /* ========== Review Section ========== */
        .review-section {
            margin: 3rem 0;
            background: var(--light);
            padding: 2rem;
            border-radius: 20px;
        }

        .review-section h2 {
            color: var(--primary);
            margin-bottom: 2rem;
            text-align: center;
            font-size: 2rem;
        }

        .review-item {
            background: white;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 12px;
            border-left: 5px solid var(--border);
            transition: var(--transition);
            animation: slideInLeft 0.5s ease-out;
            animation-fill-mode: both;
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .review-item.correct { border-left-color: var(--success); }
        .review-item.incorrect { border-left-color: var(--danger); }
        .review-item.skipped { border-left-color: #94a3b8; }

        .review-question {
            font-weight: 600;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            line-height: 1.5;
        }

        .review-answers {
            display: grid;
            gap: 0.5rem;
        }

        .answer-line {
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: 500;
        }

        .answer-line.correct {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .answer-line.user-answer {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        /* ========== Actions Bar ========== */
        .actions-bar {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 3rem;
            flex-wrap: wrap;
        }

        .btn-download {
            background: var(--primary-gradient);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            box-shadow: var(--shadow);
        }

        .btn-download:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: var(--shadow-lg);
        }

        /* ========== Responsive ========== */
        @media (max-width: 768px) {
            .welcome-title {
                font-size: 2.5rem;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .exam-header {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }

            .progress-bar {
                width: 100%;
            }

            .question-card {
                padding: 1.5rem;
            }

            .question-text {
                font-size: 1.2rem;
            }

            .nav-container {
                flex-direction: column;
                gap: 1.5rem;
            }

            .question-nav-grid {
                order: 2;
                justify-content: center;
                max-width: 100%;
            }

            .action-buttons {
                order: 1;
                width: 100%;
                justify-content: center;
            }

            .score-circle {
                width: 180px;
                height: 180px;
                font-size: 2.5rem;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .actions-bar {
                flex-direction: column;
            }

            .btn-download {
                width: 100%;
                justify-content: center;
            }
        }

        /* ========== Utility Classes ========== */
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        @keyframes slideInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========== Loading Animation ========== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Welcome Screen -->
    <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-header">
            <h1 class="welcome-title">ğŸ¯ Ù…Ù†ØµØ© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h1>
            <p class="welcome-subtitle">Ø§Ø®ØªØ¨Ø§Ø± ØªÙ‚ÙŠÙŠÙ… Ø´Ø§Ù…Ù„ Ù„Ù‚ÙŠØ§Ø³ Ù…Ø³ØªÙˆØ§Ùƒ Ø§Ù„Ù…Ø¹Ø±ÙÙŠ</p>
        </div>

        <div class="features-grid">
            <div class="feature-card">
                <span class="feature-icon">ğŸ”„</span>
                <div class="feature-title">Ø£Ø³Ø¦Ù„Ø© Ø°ÙƒÙŠØ©</div>
                <p>Ù„Ø§ ØªØªÙƒØ±Ø± Ø£Ø¨Ø¯Ø§Ù‹ØŒ ØªØªØºÙŠØ± ÙÙŠ ÙƒÙ„ Ù…Ø­Ø§ÙˆÙ„Ø©</p>
            </div>
            <div class="feature-card">
                <span class="feature-icon">â±ï¸</span>
                <div class="feature-title">Ù…Ø¤Ù‚Øª Ø¯Ù‚ÙŠÙ‚</div>
                <p>Ù…Ø¹ ØªØ­Ø°ÙŠØ±Ø§Øª Ø°ÙƒÙŠØ© ÙˆÙ‚Øª Ø§Ù„Ø¶ØºØ·</p>
            </div>
            <div class="feature-card">
                <span class="feature-icon">ğŸ“Š</span>
                <div class="feature-title">ØªØ­Ù„ÙŠÙ„ Ø£Ø¯Ø§Ø¡</div>
                <p>ØªÙØ§ØµÙŠÙ„ Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø´Ø§Ù…Ù„Ø©</p>
            </div>
            <div class="feature-card">
                <span class="feature-icon">ğŸ“œ</span>
                <div class="feature-title">Ø´Ù‡Ø§Ø¯Ø© Ù…Ø¹ØªÙ…Ø¯Ø©</div>
                <p>PDF Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</p>
            </div>
        </div>

        <div class="exam-stats">
            <div class="stat-item">
                <div class="stat-value">10</div>
                <div class="stat-label">Ø³Ø¤Ø§Ù„</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">10</div>
                <div class="stat-label">Ø¯Ù‚ÙŠÙ‚Ø©</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">70%</div>
                <div class="stat-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">âˆ</div>
                <div class="stat-label">Ù…Ø­Ø§ÙˆÙ„Ø§Øª ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©</div>
            </div>
        </div>

        <button class="btn-primary" onclick="startExam()">
            ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¢Ù†
        </button>
    </div>

    <!-- Exam Screen -->
    <div class="exam-screen" id="examScreen">
        <div class="exam-header">
            <div class="exam-info">
                <div class="question-progress" id="questionProgress">Ø§Ù„Ø³Ø¤Ø§Ù„ 1 Ù…Ù† 10</div>
                <div class="progress-bar">
                    <div class="progress-bar-fill" id="progressBarFill"></div>
                </div>
            </div>
            <div class="timer-box" id="timerBox">
                <span>â±ï¸</span>
                <span id="timerText">10:00</span>
            </div>
        </div>

        <div class="question-container" id="questionContainer"></div>

        <div class="nav-container" id="navContainer">
            <div class="question-nav-grid" id="questionNavGrid"></div>
            <div class="action-buttons">
                <button class="btn btn-secondary" id="prevBtn" onclick="navigateQuestion(-1)">
                    â¬…ï¸ Ø§Ù„Ø³Ø§Ø¨Ù‚
                </button>
                <button class="btn btn-secondary" onclick="markForReview()">
                    ğŸš© Ø¹Ù„Ø§Ù…Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
                </button>
                <button class="btn btn-success hidden" id="finishBtn" onclick="finishExam()">
                    âœ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                </button>
                <button class="btn btn-primary" id="nextBtn" onclick="navigateQuestion(1)">
                    Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸
                </button>
            </div>
        </div>
    </div>

    <!-- Results Screen -->
    <div class="results-screen" id="resultsScreen">
        <div class="results-header">
            <h1 id="resultTitle">ğŸ‰ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!</h1>
            <p id="resultSubtitle">Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­</p>
            <div class="score-circle" id="scoreCircle">
                <span>85%</span>
            </div>
        </div>

        <div class="results-grid">
            <div class="result-card">
                <h3>Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h3>
                <div class="value" id="finalScore">8.5 / 10</div>
            </div>
            <div class="result-card">
                <h3>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</h3>
                <div class="value" id="percentage">85%</div>
            </div>
            <div class="result-card">
                <h3>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚</h3>
                <div class="value" id="timeTaken">08:32</div>
            </div>
            <div class="result-card">
                <h3>Ø§Ù„Ø­Ø§Ù„Ø©</h3>
                <div class="value" id="examStatus">âœ… Ù†Ø§Ø¬Ø­</div>
            </div>
            <div class="result-card">
                <h3>Ø§Ù„Ø³Ø±Ø¹Ø©</h3>
                <div class="value" id="speed">51 Ø«/Ø³Ø¤Ø§Ù„</div>
            </div>
            <div class="result-card">
                <h3>Ø§Ù„Ø¯Ù‚Ø©</h3>
                <div class="value" id="accuracy">85%</div>
            </div>
        </div>

        <div class="review-section">
            <h2>ğŸ“ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</h2>
            <div id="reviewContent"></div>
        </div>

        <div class="actions-bar">
            <button class="btn-download" onclick="downloadCertificate()">
                ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© (PDF)
            </button>
            <button class="btn-download" onclick="shareResult()">
                ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù†ØªÙŠØ¬Ø©
            </button>
            <button class="btn-download" onclick="restartExam()">
                ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯
            </button>
        </div>
    </div>

    <script>
        // ========== Professional Exam Data ==========
        const professionalQuestions = [
            {
                text: "Ù…Ø§ Ù‡ÙŠ Ø£Ù‡Ù… Ù…Ù‡Ø§Ø±Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙ…ØªÙ„ÙƒÙ‡Ø§ Ø§Ù„Ù…Ø·ÙˆØ± ÙÙŠ 2024ØŸ",
                options: ["Ø¥ØªÙ‚Ø§Ù† Ù„ØºØ© ÙˆØ§Ø­Ø¯Ø©", "Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù…Ø³ØªÙ…Ø±", "Ø³Ø±Ø¹Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø©", "Ø­ÙØ¸ Ø§Ù„ÙƒÙˆØ¯"],
                correct: 1,
                category: "ØªØ·ÙˆÙŠØ± Ù…Ù‡Ù†ÙŠ",
                difficulty: "Ù…ØªÙˆØ³Ø·"
            },
            {
                text: "Ù…Ø§ Ù‡Ùˆ Ø£ÙØ¶Ù„ Ù†Ù‡Ø¬ Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©ØŸ",
                options: ["ØªØ´ÙÙŠØ± ÙÙ‚Ø·", "Ø¹Ø¯Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ†", "Security Layers", "Ø¬Ø¯Ø±Ø§Ù† Ø§Ù„Ø­Ù…Ø§ÙŠØ©"],
                correct: 2,
                category: "Ø§Ù„Ø£Ù…Ø§Ù†",
                difficulty: "ØµØ¹Ø¨"
            },
            {
                text: "Ù…Ø§ Ù‡Ùˆ Ù…Ø¨Ø¯Ø£ Ø§Ù„Ù€ 'DRY'ØŸ",
                options: ["Do Repeat Yourself", "Don't Repeat Yourself", "Do Review Yourself", "Don't Review Yourself"],
                correct: 1,
                category: "Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©",
                difficulty: "Ù…ØªÙˆØ³Ø·"
            },
            {
                text: "Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Responsive ÙˆAdaptive DesignØŸ",
                options: ["Ù„Ø§ ÙØ±Ù‚", "Responsive Ù…Ø±Ù†ØŒ Adaptive Ø«Ø§Ø¨Øª", "Responsive Ø£Ø³Ø±Ø¹", "Adaptive Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ÙÙ‚Ø·"],
                correct: 1,
                category: "ØªØµÙ…ÙŠÙ… Ø§Ù„ÙˆÙŠØ¨",
                difficulty: "Ù…ØªÙˆØ³Ø·"
            },
            {
                text: "Ù…Ø§ Ù…Ø¹Ù†Ù‰ 'Technical Debt'ØŸ",
                options: ["Ø¯ÙŠÙˆÙ† Ù…Ø§Ù„ÙŠØ©", "ØªÙ†Ø§Ø²Ù„ Ø¹Ù† Ø§Ù„Ø¬ÙˆØ¯Ø© Ù„Ù„Ø³Ø±Ø¹Ø©", "ØªÙƒÙ„ÙØ© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©", "ÙˆÙ‚Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨"],
                correct: 1,
                category: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹",
                difficulty: "Ù…ØªÙˆØ³Ø·"
            },
            {
                text: "Ù…ØªÙ‰ ØªÙØ¬Ø±Ù‰ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ØŸ",
                options: ["Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø´Ø±", "Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙ‚Ø·", "Ù…Ø³ØªÙ…Ø± Ø®Ù„Ø§Ù„ Ø§Ù„ØªØ·ÙˆÙŠØ±", "Ø¹Ù†Ø¯ Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡"],
                correct: 2,
                category: "Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ§Øª",
                difficulty: "ØµØ¹Ø¨"
            },
            {
                text: "Ù…Ø§ Ø§Ù„ØºØ±Ø¶ Ù…Ù† GitØŸ",
                options: ["Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø±Ø¹Ø©", "ØªØªØ¨Ø¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙˆØ§Ù„ØªØ¹Ø§ÙˆÙ†", "ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù…", "ØªØ´ÙÙŠØ± Ø§Ù„ÙƒÙˆØ¯"],
                correct: 1,
                category: "Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ·ÙˆÙŠØ±",
                difficulty: "Ø³Ù‡Ù„"
            },
            {
                text: "Ù…Ø§ Ù‡Ø¯Ù Code ReviewØŸ",
                options: ["Ø¥ÙŠØ¬Ø§Ø¯ Ø£Ø®Ø·Ø§Ø¡ ÙÙ‚Ø·", "Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ø¹Ø±ÙØ©", "Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø®Ø¨Ø±Ø©", "Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø§Øª"],
                correct: 1,
                category: "Ù…Ù…Ø§Ø±Ø³Ø§Øª Ø§Ù„ÙØ±ÙŠÙ‚",
                difficulty: "Ø³Ù‡Ù„"
            },
            {
                text: "Ù…Ø§ Ø£Ù‡Ù… Ø¹Ø§Ù…Ù„ Ù„Ø¨Ù†Ø§Ø¡ ÙØ±ÙŠÙ‚ Ù†Ø§Ø¬Ø­ØŸ",
                options: ["Ù…Ø·ÙˆØ±ÙˆÙ† Senior ÙÙ‚Ø·", "Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„Ø«Ù‚Ø©", "Ø³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„ Ø·ÙˆÙŠÙ„Ø©", "Ø£Ø­Ø¯Ø« Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª"],
                correct: 1,
                category: "Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©",
                difficulty: "Ø³Ù‡Ù„"
            },
            {
                text: "Ù…Ø§ Ø£ÙØ¶Ù„ Ù…Ù…Ø§Ø±Ø³Ø© Ù„ÙƒÙˆØ¯ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØµÙŠØ§Ù†Ø©ØŸ",
                options: ["Ø£Ù‚Ù„ Ø¹Ø¯Ø¯ Ø£Ø³Ø·Ø±", "ØªØ¹Ù„ÙŠÙ‚Ø§Øª ØªÙˆØ¶ÙŠØ­ÙŠØ©", "Ø£Ø³Ù…Ø§Ø¡ x,y,z", "Ù…Ù„Ù ÙˆØ§Ø­Ø¯"],
                correct: 1,
                category: "Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯",
                difficulty: "Ø³Ù‡Ù„"
            }
        ];

        // ========== Exam Manager Class ==========
        class ProfessionalExamManager {
            constructor() {
                this.questions = [...professionalQuestions].sort(() => Math.random() - 0.5);
                this.currentIndex = 0;
                this.answers = new Array(this.questions.length).fill(null);
                this.reviewFlags = new Array(this.questions.length).fill(false);
                this.startTime = null;
                this.endTime = null;
                this.timeLimit = 600;
                this.timeRemaining = this.timeLimit;
                this.timer = null;
                this.attemptId = this.generateUUID();
                this.questionTimes = [];
                this.focusLostCount = 0;
            }

            generateUUID() {
                return 'exam_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }

            start() {
                this.startTime = Date.now();
                this.startTimer();
                this.renderQuestion();
                this.updateNavigation();
                this.setupFocusMode();
                this.hideLoading();
            }

            showLoading() {
                document.getElementById('loadingOverlay').style.display = 'flex';
            }

            hideLoading() {
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                }, 500);
            }

            startTimer() {
                this.timer = setInterval(() => {
                    this.timeRemaining--;
                    this.updateTimerDisplay();

                    if (this.timeRemaining <= 0) {
                        this.finish();
                    }
                }, 1000);
            }

            updateTimerDisplay() {
                const minutes = Math.floor(this.timeRemaining / 60);
                const seconds = this.timeRemaining % 60;
                const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                document.getElementById('timerText').textContent = display;
                const timerBox = document.getElementById('timerBox');

                timerBox.className = 'timer-box';
                if (this.timeRemaining <= 60) {
                    timerBox.classList.add('danger');
                } else if (this.timeRemaining <= 300) {
                    timerBox.classList.add('warning');
                }
            }

            renderQuestion() {
                const container = document.getElementById('questionContainer');
                const question = this.questions[this.currentIndex];
                
                if (!this.questionTimes[this.currentIndex]) {
                    this.questionTimes[this.currentIndex] = { start: Date.now(), end: null };
                } else {
                    this.questionTimes[this.currentIndex].start = Date.now();
                }

                container.innerHTML = `
                    <div class="question-card">
                        <div class="question-header">
                            <div class="question-number">${this.currentIndex + 1}</div>
                            <div>
                                <div class="question-text">${question.text}</div>
                                <div class="question-meta">
                                    <span class="meta-tag">ğŸ“‚ ${question.category}</span>
                                    <span class="meta-tag">${this.getDifficultyIcon(question.difficulty)} ${question.difficulty}</span>
                                </div>
                            </div>
                        </div>
                        <div class="options-container">
                            ${question.options.map((option, i) => `
                                <div class="option-wrapper">
                                    <input type="radio" 
                                           id="q${this.currentIndex}_opt${i}" 
                                           name="q${this.currentIndex}" 
                                           value="${i}" 
                                           class="option-input"
                                           ${this.answers[this.currentIndex] === i ? 'checked' : ''}
                                           onchange="examManager.saveAnswer(${i})">
                                    <label for="q${this.currentIndex}_opt${i}" class="option-label">
                                        <span class="option-letter">${String.fromCharCode(65 + i)}.</span>
                                        ${option}
                                    </label>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;

                this.updateProgress();
            }

            getDifficultyIcon(difficulty) {
                const icons = { 'Ø³Ù‡Ù„': 'ğŸŸ¢', 'Ù…ØªÙˆØ³Ø·': 'ğŸŸ¡', 'ØµØ¹Ø¨': 'ğŸ”´' };
                return icons[difficulty] || 'âšª';
            }

            saveAnswer(answerIndex) {
                this.answers[this.currentIndex] = answerIndex;
                
                if (this.questionTimes[this.currentIndex]) {
                    this.questionTimes[this.currentIndex].end = Date.now();
                }

                this.updateNavigation();
                
                // Auto-advance after 1 second
                setTimeout(() => {
                    if (this.currentIndex < this.questions.length - 1) {
                        this.navigate(1);
                    }
                }, 1000);
            }

            navigate(direction) {
                const newIndex = this.currentIndex + direction;
                if (newIndex >= 0 && newIndex < this.questions.length) {
                    this.currentIndex = newIndex;
                    this.renderQuestion();
                    this.updateNavigation();
                }
            }

            goToQuestion(index) {
                this.currentIndex = index;
                this.renderQuestion();
                this.updateNavigation();
            }

            markForReview() {
                this.reviewFlags[this.currentIndex] = !this.reviewFlags[this.currentIndex];
                this.updateNavigation();
            }

            updateNavigation() {
                document.getElementById('questionProgress').textContent = 
                    `Ø§Ù„Ø³Ø¤Ø§Ù„ ${this.currentIndex + 1} Ù…Ù† ${this.questions.length}`;

                const progress = ((this.currentIndex + 1) / this.questions.length) * 100;
                document.getElementById('progressBarFill').style.width = progress + '%';

                document.getElementById('prevBtn').style.visibility = 
                    this.currentIndex === 0 ? 'hidden' : 'visible';
                
                const isLast = this.currentIndex === this.questions.length - 1;
                document.getElementById('nextBtn').classList.toggle('hidden', isLast);
                document.getElementById('finishBtn').classList.toggle('hidden', !isLast);

                const grid = document.getElementById('questionNavGrid');
                grid.innerHTML = this.questions.map((_, i) => {
                    const classes = ['nav-btn'];
                    if (this.answers[i] !== null) classes.push('answered');
                    if (this.reviewFlags[i]) classes.push('review');
                    if (i === this.currentIndex) classes.push('current');
                    
                    return `
                        <button class="${classes.join(' ')}" onclick="examManager.goToQuestion(${i})" title="Ø§Ù„Ø³Ø¤Ø§Ù„ ${i + 1}">
                            ${i + 1}
                        </button>
                    `;
                }).join('');
            }

            setupFocusMode() {
                document.addEventListener('visibilitychange', () => {
                    if (!this.endTime && document.hidden) {
                        this.focusLostCount++;
                        console.warn(`âš ï¸ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ - Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Øª: ${this.focusLostCount}`);
                        
                        if (this.focusLostCount >= 3) {
                            alert('âš ï¸ ØªØ­Ø°ÙŠØ±: Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨ØªØºÙŠÙŠØ± Ø§Ù„ØªØ±ÙƒÙŠØ² Ø£ÙƒØ«Ø± Ù…Ù† 3 Ù…Ø±Ø§Øª. Ù‚Ø¯ ÙŠØ¤Ø«Ø± Ù‡Ø°Ø§ Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬ØªÙƒ.');
                        }
                    }
                });
            }

            calculateResults() {
                let correct = 0;
                let totalTime = 0;
                const categoryStats = {};

                this.questions.forEach((q, i) => {
                    if (this.questionTimes[i] && this.questionTimes[i].end) {
                        const time = (this.questionTimes[i].end - this.questionTimes[i].start) / 1000;
                        totalTime += time;
                    }

                    if (this.answers[i] === q.correct) {
                        correct++;
                    }

                    if (!categoryStats[q.category]) {
                        categoryStats[q.category] = { total: 0, correct: 0 };
                    }
                    categoryStats[q.category].total++;
                    if (this.answers[i] === q.correct) {
                        categoryStats[q.category].correct++;
                    }
                });

                const percentage = Math.round((correct / this.questions.length) * 100);
                const avgTime = totalTime / this.questions.length;
                const passed = percentage >= 70;

                return {
                    correct,
                    total: this.questions.length,
                    percentage,
                    passed,
                    totalTime,
                    avgTime: Math.round(avgTime),
                    categoryStats,
                    focusLostCount: this.focusLostCount,
                    perQuestion: this.questionTimes.map((qt, i) => ({
                        time: qt && qt.end ? Math.round((qt.end - qt.start) / 1000) : 0,
                        correct: this.answers[i] === this.questions[i].correct,
                        category: this.questions[i].category,
                        difficulty: this.questions[i].difficulty
                    }))
                };
            }

            finish() {
                clearInterval(this.timer);
                this.endTime = Date.now();

                const results = this.calculateResults();
                this.sendAnalytics(results);
                this.showResults(results);
            }

            sendAnalytics(results) {
                const payload = {
                    attemptId: this.attemptId,
                    timestamp: new Date().toISOString(),
                    results: results,
                    device: navigator.userAgent,
                    language: navigator.language,
                    screenResolution: `${window.screen.width}x${window.screen.height}`
                };
                
                console.log('ğŸ“Š Analytics Data:', payload);
                localStorage.setItem('exam_analytics_' + this.attemptId, JSON.stringify(payload));
                
                // Save to history
                const history = JSON.parse(localStorage.getItem('exam_history') || '[]');
                history.unshift({
                    attemptId: this.attemptId,
                    date: new Date().toLocaleDateString('ar-SA'),
                    score: results.percentage,
                    passed: results.passed,
                    time: results.totalTime
                });
                localStorage.setItem('exam_history', JSON.stringify(history.slice(0, 10))); // Keep last 10
            }

            showResults(results) {
                document.getElementById('examScreen').style.display = 'none';
                
                const resultsScreen = document.getElementById('resultsScreen');
                resultsScreen.style.display = 'block';
                resultsScreen.classList.add('fade-in');

                // Update result title based on performance
                const titleElement = document.getElementById('resultTitle');
                const subtitleElement = document.getElementById('resultSubtitle');
                
                if (results.percentage >= 90) {
                    titleElement.textContent = 'ğŸ† Ø£Ø¯Ø§Ø¡ Ù…Ø°Ù‡Ù„!';
                    subtitleElement.textContent = 'Ø£Ù†Øª Ø®Ø¨ÙŠØ± Ø­Ù‚ÙŠÙ‚ÙŠ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ø§Ù„';
                } else if (results.percentage >= 70) {
                    titleElement.textContent = 'ğŸ‰ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!';
                    subtitleElement.textContent = 'Ù„Ù‚Ø¯ Ù†Ø¬Ø­Øª ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±';
                } else {
                    titleElement.textContent = 'ğŸ’ª Ù„Ø§ ØªØ³ØªØ³Ù„Ù…!';
                    subtitleElement.textContent = 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„ØªØ­Ø³ÙŠÙ† Ù†ØªÙŠØ¬ØªÙƒ';
                }

                const scoreCircle = document.getElementById('scoreCircle');
                scoreCircle.innerHTML = `<span>${results.percentage}%</span>`;
                scoreCircle.style.background = results.percentage >= 70 ? 
                    'var(--success-gradient)' : 'var(--danger-gradient)';

                document.getElementById('finalScore').textContent = `${results.correct} / ${results.total}`;
                document.getElementById('percentage').textContent = results.percentage + '%';
                
                const minutes = Math.floor(results.totalTime / 60);
                const seconds = results.totalTime % 60;
                document.getElementById('timeTaken').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                document.getElementById('examStatus').innerHTML = results.passed ? 
                    'âœ… Ù†Ø§Ø¬Ø­' : 'âŒ Ù„Ù… ÙŠØ¬ØªØ²';
                document.getElementById('examStatus').style.color = results.passed ? '#10b981' : '#ef4444';
                
                document.getElementById('speed').textContent = `${results.avgTime} Ø«/Ø³Ø¤Ø§Ù„`;
                document.getElementById('accuracy').textContent = results.percentage + '%';

                if (results.focusLostCount > 0) {
                    const warning = document.createElement('div');
                    warning.className = 'review-item warning';
                    warning.innerHTML = `
                        <div class="review-question">
                            âš ï¸ ØªØ­Ø°ÙŠØ±: Ù„Ù‚Ø¯ ÙÙ‚Ø¯Øª Ø§Ù„ØªØ±ÙƒÙŠØ² ${results.focusLostCount} Ù…Ø±Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                        </div>
                    `;
                    document.getElementById('reviewContent').appendChild(warning);
                }

                this.renderReview(results);
            }

            renderReview(results) {
                const container = document.getElementById('reviewContent');
                
                // Group by category
                const byCategory = {};
                results.perQuestion.forEach((q, i) => {
                    const category = this.questions[i].category;
                    if (!byCategory[category]) byCategory[category] = [];
                    byCategory[category].push({ ...q, index: i });
                });

                Object.entries(byCategory).forEach(([category, questions]) => {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.innerHTML = `<h3 style="color: var(--primary); margin: 2rem 0 1rem;">ğŸ“‚ ${category}</h3>`;
                    container.appendChild(categoryDiv);

                    questions.forEach(({ index, time, correct }) => {
                        const q = this.questions[index];
                        const userAnswer = this.answers[index];
                        const status = userAnswer === null ? 'skipped' : (correct ? 'correct' : 'incorrect');
                        const statusText = userAnswer === null ? 'â­ï¸ ØªÙ… Ø§Ù„ØªØ®Ø·ÙŠ' : 
                                         (correct ? 'âœ… ØµØ­ÙŠØ­' : 'âŒ Ø®Ø§Ø·Ø¦');
                        
                        const reviewItem = document.createElement('div');
                        reviewItem.className = `review-item ${status}`;
                        reviewItem.innerHTML = `
                            <div class="review-question">
                                ${index + 1}. ${q.text} 
                                <span style="float: left; font-size: 0.9rem; color: #64748b; background: #f1f5f9; padding: 0.25rem 0.5rem; border-radius: 5px;">
                                    â±ï¸ ${time} Ø«Ø§Ù†ÙŠØ©
                                </span>
                            </div>
                            <div class="review-answers">
                                <div class="answer-line correct">
                                    âœ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${q.options[q.correct]}
                                </div>
                                ${userAnswer !== null ? 
                                    `<div class="answer-line user-answer">
                                        ${userAnswer === q.correct ? 'âœ…' : 'âŒ'} Ø¥Ø¬Ø§Ø¨ØªÙƒ: ${q.options[userAnswer]}
                                    </div>` : 
                                    '<div class="answer-line user-answer">â­ï¸ Ù„Ù… ØªØ¬Ø¨</div>'
                                }
                            </div>
                        `;
                        container.appendChild(reviewItem);
                    });
                });
            }
        }

        // ========== Global Functions ==========
        let examManager;

        function startExam() {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('examScreen').style.display = 'block';
            
            examManager = new ProfessionalExamManager();
            examManager.start();
        }

        function navigateQuestion(direction) {
            examManager.navigate(direction);
        }

        function goToQuestion(index) {
            examManager.goToQuestion(index);
        }

        function markForReview() {
            examManager.markForReview();
        }

        function finishExam() {
            if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯.')) {
                examManager.finish();
            }
        }

        function downloadCertificate() {
            examManager.showLoading();
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            const results = examManager.calculateResults();
            
            // Professional Certificate Design
            pdf.setFontSize(24);
            pdf.setTextColor(14, 165, 233);
            pdf.setFont('helvetica', 'bold');
            pdf.text('Ø´Ù‡Ø§Ø¯Ø© Ø§Ø¬ØªÙŠØ§Ø² Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 105, 40, { align: 'center' });
            
            // Decorative line
            pdf.setLineWidth(0.5);
            pdf.setDrawColor(14, 165, 233);
            pdf.line(50, 45, 160, 45);
            
            pdf.setFontSize(14);
            pdf.setTextColor(100, 100, 100);
            pdf.setFont('helvetica', 'normal');
            pdf.text('Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ØªÙØ«Ø¨Øª Ø§Ù„Ù†Ø¬Ø§Ø­ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª', 105, 60, { align: 'center' });
            
            // Score Circle
            pdf.setFillColor(results.passed ? 16 : 239, results.passed ? 185 : 68, results.passed ? 129 : 68);
            pdf.circle(105, 85, 25, 'F');
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(18);
            pdf.setFont('helvetica', 'bold');
            pdf.text(`${results.percentage}%`, 105, 90, { align: 'center' });
            
            // Details
            pdf.setTextColor(0, 0, 0);
            pdf.setFontSize(12);
            pdf.setFont('helvetica', 'normal');
            
            const date = new Date().toLocaleDateString('ar-SA', { year: 'numeric', month: 'long', day: 'numeric' });
            pdf.text(`Ø§Ù„ØªØ§Ø±ÙŠØ®: ${date}`, 105, 125, { align: 'center' });
            pdf.text(`Ø±Ù‚Ù… Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©: ${examManager.attemptId}`, 105, 135, { align: 'center' });
            
            // Results Table
            const startY = 150;
            const lineHeight = 8;
            
            pdf.setFillColor(240, 240, 240);
            pdf.rect(40, startY - 5, 130, lineHeight * 6 + 10, 'F');
            
            pdf.setFont('helvetica', 'bold');
            pdf.text('Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:', 50, startY);
            pdf.text('Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚:', 50, startY + lineHeight);
            pdf.text('Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª Ù„Ù„Ø³Ø¤Ø§Ù„:', 50, startY + lineHeight * 2);
            pdf.text('Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª ÙÙ‚Ø¯Ø§Ù† Ø§Ù„ØªØ±ÙƒÙŠØ²:', 50, startY + lineHeight * 3);
            pdf.text('Ø§Ù„Ø­Ø§Ù„Ø©:', 50, startY + lineHeight * 4);
            pdf.text('Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©:', 50, startY + lineHeight * 5);
            
            pdf.setFont('helvetica', 'normal');
            pdf.text(`${results.correct} / ${results.total}`, 140, startY, { align: 'right' });
            
            const minutes = Math.floor(results.totalTime / 60);
            const seconds = results.totalTime % 60;
            pdf.text(`${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`, 140, startY + lineHeight, { align: 'right' });
            
            pdf.text(`${results.avgTime} Ø«Ø§Ù†ÙŠØ©`, 140, startY + lineHeight * 2, { align: 'right' });
            pdf.text(`${results.focusLostCount} Ù…Ø±Ø§Øª`, 140, startY + lineHeight * 3, { align: 'right' });
            pdf.text(results.passed ? 'âœ… Ù†Ø§Ø¬Ø­' : 'âŒ Ù„Ù… ÙŠØ¬ØªØ²', 140, startY + lineHeight * 4, { align: 'right' });
            pdf.text(`${results.percentage}%`, 140, startY + lineHeight * 5, { align: 'right' });
            
            // Footer
            pdf.setFontSize(10);
            pdf.setTextColor(150, 150, 150);
            pdf.text('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Ù‹ Ø¹Ø¨Ø± Ù…Ù†ØµØ© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª', 105, 280, { align: 'center' });
            
            pdf.save(`Ø´Ù‡Ø§Ø¯Ø©-Ø§Ø®ØªØ¨Ø§Ø±-${examManager.attemptId}.pdf`);
            examManager.hideLoading();
        }

        function shareResult() {
            const results = examManager.calculateResults();
            const status = results.passed ? 'Ù†Ø§Ø¬Ø­' : 'Ù„Ù… ÙŠØ¬ØªØ²';
            const text = `Ù„Ù‚Ø¯ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${results.percentage}% (${results.correct}/${results.total}) ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª - Ø§Ù„Ø­Ø§Ù„Ø©: ${status} ğŸ¯`;
            
            const shareData = {
                title: 'Ù†ØªÙŠØ¬Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª',
                text: text,
                url: window.location.href
            };

            if (navigator.share && navigator.canShare(shareData)) {
                navigator.share(shareData);
            } else {
                navigator.clipboard.writeText(text + '\n' + window.location.href).then(() => {
                    alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!');
                });
            }
        }

        function restartExam() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯ØŸ Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø£Ø³Ø¦Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©.')) {
                location.reload();
            }
        }

        // ========== Keyboard Shortcuts ==========
        document.addEventListener('keydown', (e) => {
            if (!examManager || examManager.endTime) return;

            switch(e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    navigateQuestion(-1);
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    if (examManager.currentIndex === examManager.questions.length - 1) {
                        finishExam();
                    } else {
                        navigateQuestion(1);
                    }
                    break;
                case '1': case '2': case '3': case '4':
                    const optionIndex = parseInt(e.key) - 1;
                    const radio = document.querySelector(`#q${examManager.currentIndex}_opt${optionIndex}`);
                    if (radio) {
                        radio.checked = true;
                        examManager.saveAnswer(optionIndex);
                    }
                    break;
                case 'r':
                case 'R':
                    markForReview();
                    break;
                case 'Escape':
                    e.preventDefault();
                    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŸ')) {
                        finishExam();
                    }
                    break;
                case 'F':
                case 'f':
                    if (examManager.currentIndex === examManager.questions.length - 1) {
                        finishExam();
                    }
                    break;
            }
        });

        // ========== Prevent Tab Switching (Advanced) ==========
        document.addEventListener('visibilitychange', () => {
            if (examManager && !examManager.endTime && document.hidden) {
                examManager.focusLostCount++;
                console.warn(`âš ï¸ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ - Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Øª: ${examManager.focusLostCount}`);
                
                // Show warning after 2 times
                if (examManager.focusLostCount === 2) {
                    alert('âš ï¸ ØªØ­Ø°ÙŠØ±: Ù„Ø§ ØªØºÙŠØ± Ø§Ù„ØªØ±ÙƒÙŠØ² Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±. Ø¨Ø¹Ø¯ 3 Ù…Ø±Ø§Øª Ù‚Ø¯ ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬ØªÙƒ.');
                }
            }
        });

        // ========== Auto-save Progress ==========
        window.addEventListener('beforeunload', (e) => {
            if (examManager && !examManager.endTime) {
                e.preventDefault();
                e.returnValue = 'Ù„Ø¯ÙŠÙƒ Ø§Ø®ØªØ¨Ø§Ø± Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯Ù…. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©ØŸ';
            }
        });

        // ========== Performance Optimization ==========
        // Debounce function for better performance
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Optimize resize events
        window.addEventListener('resize', debounce(() => {
            console.log('Window resized');
        }, 250));
    </script>
</body>
</html>
